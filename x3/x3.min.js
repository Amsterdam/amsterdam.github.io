
Function.prototype.extendsAttributes=function(b){var c=this;var a=function(){b.apply(this,arguments);c.apply(this,arguments)};a.prototype=new b();return a};Function.prototype.extendsFrom=function(){var d=new Array(arguments.length);for(var c=0;c<arguments.length;c++){d[c]=arguments[c]}var b=this;for(var c in d){b=this.extendsAttributes(d[c])}for(var c in d){for(var a in d[c].prototype){if((typeof this[a]=="function"&&typeof d[c].prototype[a]=="function"&&d[c].prototype[a]==this[a])||typeof this[a]!="function"){b.prototype[a]=d[c].prototype[a]}}}return b};Function.extensions=function(){this._set=[];this._trig=[];this._listeners=[]};Function.extensions.prototype.set=function(c,e){var a=this;var b=null;var d=Array.prototype.slice.apply(arguments);d.shift();this._set[c]=function(){var g=true;var f=Array.prototype.slice.apply(arguments);if(typeof(e)=="function"){b=e.apply(a,f)}else{if(d.length==1){return d[0]}else{b=d}}return b};if(c in this._trig){this._trig[c].apply(this,d)}return this};Function.extensions.prototype.trigger=function(a,b){this._trig[a]=b};Function.extensions.prototype.get=function(a){var b=Array.prototype.slice.apply(arguments);b.shift();if(a in this._set){if(typeof(this._set[a])=="function"){return this._set[a].apply(this,b)}}return this};Function.extensions.prototype.on=function(c,b,a){if(a==null){a=0}if(!(c in this._listeners)){this._listeners[c]=[]}if(!(a in this._listeners[c])){this._listeners[c][a]=[]}this._listeners[c][a].push(b)};Function.extensions.prototype.call=function(c){var b=Array.prototype.slice.apply(arguments);b.shift();if(c in this._listeners){for(var a in this._listeners[c]){for(var d in this._listeners[c][a]){this._listeners[c][a][d].apply(this,b)}}}};Function.extensions.prototype.uniqID=function(){return"_"+(parseInt((new Date().getTime()))+parseInt((Math.floor(Math.random()*1000000000000)+1)))};function x3(){this.svg=null;this.parent="";this.data=[];this.width=-1;this.height=-1;this.widthOverride=0;this.heightOverride=0;this.minHeight=-1;this.minWidth=-1;this.parentHeight=-1;this.parentWidth=-1;this.margin=[0,0,0,0];this.transitionSpeed=750;this.transition=false;this.values=[];this.id="_"+this.uniqID();this.rotation=0;this.colors=d3.scale.category20();this.set("parent",this._getParent);this.set("innerWidth",this._getInnerWidth);this.set("innerHeight",this._getInnerHeight);this.set("svg",this._getSvg);this.set("transitionSpeed",this._getTransitionSpeed);this.set("margin",this._getMargin);this.set("width",this._getWidth);this.set("minWidth",this._getMinWidth);this.set("maxWidth",this._getMaxWidth);this.set("height",this._getHeight);this.set("minHeight",this._getMinHeight);this.set("maxHeight",this._getMaxHeight);this.trigger("width",this._setWidth);this.trigger("minWidth",this._setMinWidth);this.trigger("maxWidth",this._setMaxWidth);this.trigger("height",this._setHeight);this.trigger("minHeight",this._setMinHeight);this.trigger("maxHeight",this._setMaxHeight);this.trigger("transitionSpeed",this._setTransitionSpeed);this.trigger("margin",this._setMargin)}x3=x3.extendsFrom(Function.extensions);d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};x3.prototype._calcSize=function(a,b){if(this.heightOverride==0){this.height=parseInt(b)}if(this.widthOverride==0){this.width=parseInt(a)}this.parentHeight=parseInt(b);this.parentWidth=parseInt(a);if(this.minWidth>0&&this.width<this.minWidth){this.width=this.minWidth}if(this.minHeight>0&&this.height<this.minHeight){this.height=this.minHeight}};x3.prototype.appendTo=function(d){this.parent=d;var c=d3.select(this.parent).style("height").replace("px",""),b=d3.select(this.parent).style("width").replace("px","");this._calcSize(b,c);var a=d3.select(this.parent).select("svg");if(a.empty()==true){this.svg=d3.select(this.parent).append("svg").append("g").attr("class",this.id)}else{this.svg=a.select("#"+this.id)}this.call("create")};x3.prototype._getParent=function(){return this.parent};x3.prototype._getSvg=function(){return this.svg};x3.prototype._getWidth=function(){return this.width};x3.prototype._setWidth=function(a){this.widthOverride=a>=0;this.width=a};x3.prototype._getHeight=function(){return this.height};x3.prototype._setHeight=function(a){this.heightOverride=a>=0;this.height=a};x3.prototype._getMinWidth=function(){return this.minWidth};x3.prototype._setMinWidth=function(a){this.minWidth=a;if(this.minWidth>0&&this.width<this.minWidth){this.width=this.minWidth}};x3.prototype._getMinHeight=function(){return this.minHeight};x3.prototype._setMinHeight=function(a){this.minHeight=a;if(this.minHeight>0&&this.height<this.minHeight){this.height=this.minHeight}};x3.prototype._getMaxWidth=function(){return this.maxWidth};x3.prototype._setMaxWidth=function(a){this.maxWidth=a;if(this.width>this.maxWidth){this.width=this.maxWidth}};x3.prototype._getMaxHeight=function(){return this.maxHeight};x3.prototype._setMaxHeight=function(a){this.maxHeight=a;if(this.height>this.maxHeight){this.height=this.maxHeight}};x3.prototype._getTransitionSpeed=function(){return this.transitionSpeed};x3.prototype._setTransitionSpeed=function(a){this.transitionSpeed=a};x3.prototype._getInnerHeight=function(){return(this.height-this.margin[0]-this.margin[2])};x3.prototype._getInnerWidth=function(){return(this.width-this.margin[1]-this.margin[3])};x3.prototype._getMargin=function(){return this.margin};x3.prototype._setMargin=function(d,b,a,c){this.margin=[d,b,a,c]};x3.prototype.getFirstRun=function(){return this.firstRun};x3.prototype.__redrawCore=function(){tmp=d3.select(this.parent).select("svg");if(this.transitionSpeed>0&&this.transition==true){tmp=tmp.transition().duration(this.transitionSpeed)}tmp.attr("width",this.width+"px").attr("height",this.height+"px");tmp=this.svg;if(this.transitionSpeed>0&&this.transition==true){tmp=tmp.transition().duration(this.transitionSpeed)}tmp.attr("transform","translate("+this.margin[3]+","+this.margin[0]+")")};x3.prototype.draw=function(){var c=d3.select(this.parent)[0][0],b=c.offsetHeight,a=c.offsetWidth;this._calcSize(a,b);this.__redrawCore();this.call("draw")};x3.prototype.redraw=function(){var c=d3.select(this.parent)[0][0],b=c.offsetHeight,a=c.offsetWidth;this._calcSize(a,b);this.transition=true;this.__redrawCore();this.transition=false;this.call("redraw")};x3.axis=function(){this.scale=null;this.axis=null;this.domain=[];this.group=null;this.link=null;this.orientation="left";this.textMargin=[0,0,0,0];this.margin=[0,0,0,0];this.textHeight=0;this.nrticks=0;this.bbox={height:0,width:0,x:0,y:0};this.type="linear";this.transition=false;this.set("bbox",this._getBBox);this.set("scale",[]);this.set("tickInterval",this._getTickInterval);this.set("tickCount",this.__calcTicks);this.set("position",this._getPosition);this.set("tickWidth",this._getTickWidth);this.set("orientation",this._getorientation);this.set("type",this._getType);this.set("link",this._getLink);this.set("textMargin",this._getTextMargin);this.set("tickFormat",function(b,a){return b});this.set("bottomMargin",this._getBottomMargin);this.set("topMargin",this._getTopMargin);this.set("leftMargin",this._getLeftMargin);this.set("rightMargin",this._getRightMargin);this.trigger("scale",this._setScale);this.trigger("tickInterval",this._setTickInterval);this.trigger("orientation",this._setorientation);this.trigger("type",this._setType);this.trigger("link",this._setLink);this.trigger("sort",this._setSort)};x3.axis=x3.axis.extendsFrom(Function.extensions);x3.axis.prototype._getTopMargin=function(){return this.margin[0]};x3.axis.prototype._getRightMargin=function(){return this.margin[1]};x3.axis.prototype._getBottomMargin=function(){return this.margin[2]};x3.axis.prototype._getLeftMargin=function(){return this.margin[3]};x3.axis.prototype._getTextMargin=function(){return this.textMargin};x3.axis.prototype._getTickInterval=function(){return this.nrticks};x3.axis.prototype._setTickInterval=function(a){this.nrticks=a;if(this.axis!=null){this.axis.tickFormat(function(c,b){return self.get("tickFormat",c,b)});if(this.type=="linear"&&this._getTickInterval()>0){this.axis.ticks(this.__calcTicks())}}};x3.axis.prototype._getTickWidth=function(){if(this.type=="linear"){var a=this.scale.domain();return Math.abs(this._getPosition(a[0])-this._getPosition(a[0]+1))}else{return this.scale.rangeBand()}};x3.axis.prototype._getType=function(){return this.type};x3.axis.prototype._setType=function(a){this.type=a};x3.axis.prototype._getorientation=function(){if(!args.validate(arguments,[])){return}return this.orientation};x3.axis.prototype._setorientation=function(a){this.orientation=a};x3.axis.prototype._getPosition=function(a){if(typeof(this.scale)!="function"){return 0}if(isNaN(this.scale(a))){return 0}if(this.orientation=="right"||this.orientation=="left"){return this.scale(a)+this.bbox.y}else{return this.scale(a)}};x3.axis.prototype._setLink=function(a){this.link=a};x3.axis.prototype._getLink=function(){return this.link};x3.axis.prototype._setSort=function(a){a(this.scale.domain)};x3.axis.prototype._setScale=function(b){var a=this;this.domain=b;if(this.type=="ordinal"){this.domain=this.domain.reverse()}if(this.scale!=null){this.scale.domain(this.domain)}if(this.axis!=null){this.axis.scale(this.scale).tickFormat(function(e,c){return a.get("tickFormat",e,c)});if(this.type=="linear"&&this._getTickInterval()>0){this.axis.ticks(this.__calcTicks())}}};x3.axis.prototype.__calcTicks=function(){if(this.type=="ordinal"){return 0}else{var b=this.scale.domain();var a=b.length;return Math.abs(b[a-1]-b[0])/this.nrticks}};x3.axis.prototype.__getSizes=function(){var a=this,b=this.group.selectAll("text").size();this.textMargin=[0,0,0,0];this.textHeight=0;this.bbox={height:0,width:0,x:0,y:0};this.group.selectAll("text").each(function(f,e){var c=this.getBBox();if(c.height>a.textHeight){a.textHeight=c.height}if(e==0){if(c.width>a.textMargin[3]){a.textMargin[3]=c.width}}if(e==b-1){c=this.getBBox();if(c.width>a.textMargin[1]){a.textMargin[1]=c.width}}});this.group.selectAll(".tick").each(function(f,e){var c=this.getBBox().height;if(c>a.bbox.height){a.bbox.height=c}})};x3.axis.prototype.create=function(){var a=this,b=0;orientation=this.orientation;switch(this.type){case"linear":this.scale=d3.scale.linear().domain(this.domain).range([0,this.get("parent").get("innerWidth")]);break;case"ordinal":this.scale=d3.scale.ordinal().domain(this.domain).rangeRoundBands([0,this.get("parent").get("innerHeight")],0);break}this.axis=d3.svg.axis().scale(this.scale).orient(orientation);if(this.type=="linear"&&this.nrticks>0){this.axis.ticks(this.__calcTicks())}this.group=this.get("parent").get("svg").append("g").attr("class","axis "+this.orientation).call(this.axis);this.group.selectAll(".tick").on("click",function(e,c){a.call("click",e,c)});if(JSON.stringify(this.textMargin)===JSON.stringify([0,0,0,0])||this.textHeight==0){this.__wrap();this.__getSizes()}};x3.axis.prototype._getBBox=function(){return this.bbox};x3.axis.prototype.__wrap=function(){var a=this;if(this.type=="ordinal"){this.group.selectAll("text").text(function(c,b){if(typeof(c)=="string"){return c.split("\n")[0]}else{return c}});this.group.selectAll("text").each(function(j,c){if(typeof(j)=="string"){var h=d3.select(this),g=j.split("\n"),b=0,e=1.1,f=h.attr("x"),k=0;if(g.length>1||["left","right"].indexOf(a.orientation)>=0){h.text(null);for(k=0;k<g.length;k++){word=g[k];h.append("tspan").attr("x",f).attr("y",0).attr("dy",(++b*e)+"em").text(word)}}else{return j}}});this.group.selectAll("text").attr("transform",function(e,b){var c=e.toString().split("\n");if(typeof(e)=="string"){if(["left","right"].indexOf(a.orientation)>=0){return"translate(0, "+-((this.getBBox().height/2)+3)+")"}else{if(c.length>1){return"translate(0, 4.5)"}else{return d3.select(this).attr("transform")}}}else{return d3.select(this).attr("transform")}})}};x3.axis.prototype.redraw=function(){this.transition=true;this.draw();this.transition=false};x3.axis.prototype.draw=function(){var c=this,a=0,e=0,d=null,b=this.orientation;d=this.group;if(this.get("parent").get("transitionSpeed")>0&&this.transition==true){d=d.transition().duration(this.get("parent").get("transitionSpeed")).ease("linear")}d.call(this.axis);switch(b){case"top":case"bottom":this.axis.orient(b);var d=this.group;if(this.get("parent").get("transitionSpeed")>0&&this.transition==true){d=d.transition().duration(this.get("parent").get("transitionSpeed")).ease("linear")}this.__wrap();this.__getSizes();this.bbox.y=(this.get("parent").get("innerHeight"));this.bbox.x=(this.textMargin[3]/2);if(typeof(this.get("link"))=="number"){this.bbox.y=this.get("link")}if(typeof(this.get("bottomMargin"))=="number"){this.bbox.y-=this.get("bottomMargin")}if(typeof(this.get("leftMargin"))=="number"&&this.get("leftMargin")>0){this.bbox.x+=this.get("leftMargin")-(this.textMargin[3]/2)}this.bbox.width=this.get("parent").get("innerWidth")-(this.bbox.x);if(this.type=="linear"){this.bbox.width-=(this.textMargin[1]/2)}if(typeof(this.get("rightMargin"))=="number"&&this.get("rightMargin")!=0){this.bbox.width-=(this.get("rightMargin")-(this.textMargin[1]/2))}switch(this.type){case"ordinal":this.scale.rangeRoundBands([this.bbox.width,0]);break;case"linear":this.scale.range([0,this.bbox.width]);break}this.group.selectAll(".tick").attr("class",function(g,f){return"tick tick-"+f});d=this.group;if(this.get("parent").get("transitionSpeed")>0&&this.transition==true){d=d.transition().duration(this.get("parent").get("transitionSpeed")).each("end",function(){window.setTimeout(function(){c.group.selectAll(".tick").attr("class",function(g,f){return"tick tick-"+f})},1)})}d.attr("transform",function(){return"translate("+c.bbox.x+","+c.bbox.y+")"}).call(this.axis);this.__wrap();break;case"right":case"left":this.axis.orient(b);var d=this.group;if(this.get("parent").get("transitionSpeed")>0&&this.transition==true){d=d.transition().duration(this.get("parent").get("transitionSpeed")).ease("linear")}this.__wrap();this.__getSizes();if(this.type=="linear"){this.bbox.y=(this.textHeight/2)-1}else{this.bbox.y=0}this.bbox.height=this.get("parent").get("innerHeight");if(typeof(this.get("topMargin"))=="number"){this.bbox.y+=this.get("topMargin")}if(this.type=="linear"){this.bbox.height-=(this.bbox.y+((this.textHeight/2)-1))}if(typeof(this.get("bottomMargin"))=="number"&&this.get("bottomMargin")!=0){if(this.type=="linear"){this.bbox.height-=this.get("bottomMargin")-((this.textHeight/2)-1)}else{this.bbox.height-=this.get("bottomMargin")}}switch(this.type){case"ordinal":this.scale.rangeRoundBands([this.bbox.height,0]);break;case"linear":this.scale.range([this.bbox.height,0]);break}this.group.selectAll(".tick").each(function(h,g){var f=this.getBBox().width;if(f>c.bbox.width){c.bbox.width=f}}).attr("class",function(g,f){return"tick tick-"+f});this.bbox.x=this.bbox.width;if(typeof(this.get("link"))=="number"){this.bbox.x=this.get("link")}d=this.group;if(this.get("parent").get("transitionSpeed")>0&&this.transition==true){d=d.transition().duration(this.get("parent").get("transitionSpeed")).each("end",function(){window.setTimeout(function(){c.group.selectAll(".tick").attr("class",function(g,f){return"tick tick-"+f})},1)})}d.attr("transform",function(){return"translate("+(c.bbox.x)+","+c.bbox.y+")"}).call(this.axis);this.__wrap();break}};x3.grid=function(c,a,e,d){var b=this;this.parent=null;this.transition=false;this.id=this.uniqID();this.set("axis",0);this.set("top",0);this.set("left",0);this.set("size",0)};x3.grid=x3.grid.extendsFrom(Function.extensions);x3.grid.prototype.create=function(){this.group=this.get("parent").get("svg").selectAll("#"+this.id).data([null]).enter().append("g").attr("id",this.id).attr("class","grid")};x3.grid.prototype.redraw=function(){this.transition=true;this.draw();this.transition=false};x3.grid.prototype.draw=function(){var b=this,e=this.get("axis"),f=null,d=0,a=0;if(["top","bottom"].indexOf(e.get("orientation"))>=0){a=e.get("bbox").width}else{if(["left","right"].indexOf(e.get("orientation"))>=0){a=e.get("bbox").height}}switch(e.get("type")){case"linear":f=d3.scale.linear().domain(e.get("scale")).range([0,a]);break;case"ordinal":f=d3.scale.ordinal().domain(e.get("scale")).rangeRoundBands([0,a],0);break}var c=d3.svg.axis().scale(f).orient(e.get("orientation"));if(e.get("tickInterval")>0){c.ticks(e.get("tickCount"))}this.group.attr("transform",function(){return"translate("+b.get("left")+","+b.get("top")+")"}).attr("class",function(h,g){return"grid "+e.get("orientation")}).call(c.tickSize(this.get("size")).tickFormat(""))};x3.bar=function(){var a=this;this.parent=undefined;this.transition=false;this.group=undefined;this.datagroup=undefined;this.container=undefined;this.firstrun=false;this.id=this.uniqID();this.trigger("data",this._setData);this.set("width",0);this.set("end",0);this.set("start",0);this.set("left",0)};x3.bar=x3.bar.extendsFrom(Function.extensions);x3.bar.prototype.create=function(){var a=this;this.group=this.get("parent").get("svg").selectAll("#"+this.id).data([null]).enter().append("g").attr("id",this.id);this.firstrun=true};x3.bar.prototype._setData=function(b){var a=this;this.data=b;this.container=d3.select("#"+this.id).selectAll(".datagroup").data(this.data);this.datagroup=this.container.enter().append("g").attr("class",function(e,c){return"datagroup"});tmp=this.datagroup.append("rect")};x3.bar.prototype.redraw=function(){this.transition=true;this.draw();this.transition=false};x3.bar.prototype._transition=function(b){var a=this;if(this.get("parent").get("transitionSpeed")>0&&this.transition==true){b=b.transition().duration(this.get("parent").get("transitionSpeed"))}b.attr("width",function(e,c){if("x" in e){return a.get("width",e,c,false)}else{return d3.select(this).attr("width")}}).attr("fill",function(e,c){if("color" in e){return e.color}else{return d3.select(this).attr("fill")}}).attr("x",function(e,c){if("x" in e){return a.get("left",e,c,false)}else{return d3.select(this).attr("x")}}).attr("height",function(e,c){if("y" in e){return Math.abs(a.get("end",e,c,false))}else{return d3.select(this).attr("height")}}).attr("y",function(f,e){if("y" in f){var c=a.get("end",f,e,false);var g=a.get("start",f,e,false);if(c>0){return g-c}else{return g}}else{return d3.select(this).attr("y")}})};x3.bar.prototype.draw=function(){var a=this;if(this.firstrun==true){if(this.datagroup==undefined){return}var b=this.datagroup.select("rect");b.attr("width",function(e,c){if("x" in e){return a.get("width",e,c,false)}else{return d3.select(this).attr("width")}}).attr("fill",function(e,c){if("color" in e){return e.color}else{return d3.select(this).attr("fill")}}).attr("x",function(e,c){if("x" in e){return a.get("left",e,c,false)}else{return d3.select(this).attr("x")}}).attr("height",function(e,c){return 0}).attr("y",function(e,c){return a.get("start",e,c,true)});this._transition(b);this.firstrun=false}if(this.container==undefined){return}var b=this.container.select("rect");this._transition(b)};x3.column=function(){var a=this;this.parent=undefined;this.transition=false;this.group=undefined;this.datagroup=undefined;this.container=undefined;this.firstrun=true;this.id=this.uniqID();this.trigger("data",this._setData);this.set("start",0);this.set("height",0);this.set("end",0);this.set("top",0)};x3.column=x3.column.extendsFrom(Function.extensions);x3.column.prototype.create=function(){var a=this;this.group=this.get("parent").get("svg").selectAll("#"+this.id).data([null]).enter().append("g").attr("id",this.id)};x3.column.prototype._setData=function(){var a=this;this.data=this.get("data");this.container=d3.select("#"+this.id).selectAll(".datagroup").data(this.data);this.datagroup=this.container.enter().append("g").attr("class","datagroup");this.datagroup.append("rect")};x3.column.prototype.redraw=function(){this.transition=true;this.draw();this.transition=false};x3.column.prototype._transition=function(b){var a=this;if(this.get("parent").get("transitionSpeed")>0&&this.transition==true){b=b.transition().duration(this.get("parent").get("transitionSpeed"))}b.attr("fill",function(e,c){if("color" in e){return e.color}else{return d3.select(this).attr("fill")}}).attr("y",function(e,c){if("y" in e){return a.get("top",e,c,false)}else{return d3.select(this).attr("y")}}).attr("width",function(e,c){if("x" in e){return Math.abs(a.get("end",e,c,false))}else{return d3.select(this).attr("width")}}).attr("x",function(f,c){if("x" in f){var e=a.get("end",f,c,false);var g=a.get("start",f,c,false);if(e>0){return g}else{return g-Math.abs(e)}}else{return d3.select(this).attr("x")}})};x3.column.prototype.draw=function(){var a=this;if(this.firstrun==true){if(this.datagroup==undefined){return}var b=this.datagroup.select("rect");b.attr("width",function(e,c){return 0}).attr("height",function(e,c){if("y" in e){return a.get("height",e,c,true)}else{return d3.select(this).attr("height")}}).attr("y",function(e,c){if("y" in e){return a.get("top",e,c,true)}else{return d3.select(this).attr("y")}}).attr("x",function(e,c){return a.get("start",e,c,true)}).attr("fill",function(e,c){if("color" in e){return e.color}else{return d3.select(this).attr("fill")}});this._transition(b)}if(this.container==undefined){return}var b=this.container.select("rect");this._transition(b)};x3.line=function(){this.transition=false;this.data=[];this.lines=[];this.id=this.uniqID();this.trigger("data",this._setData);this.set("position-x",0);this.set("position-y",0);this.set("order",0)};x3.line=x3.line.extendsFrom(Function.extensions);x3.line.prototype.create=function(){var a=this;this.group=this.get("parent").get("svg").selectAll("#"+this.id).data([null]).enter().append("g").attr("id",this.id);this.line=d3.svg.line().interpolate("monotone").x(function(c,b){return a.get("position-x",c,b)}).y(function(c,b){return a.get("position-y",c,b)}).defined(function(c,b){return !isNaN(c.y)})};x3.line.prototype._setData=function(e){var d=this;for(var b in e){var i=false;for(var h in this.data){if(this.data[h]["id"]==e[b]["id"]){i=true;for(var g in e[b]["points"]){var f=false;for(var c in this.data[h]["points"]){if(this.data[h]["points"][c]["x"]==e[b]["points"][g]["x"]){this.data[h]["points"][c]["y"]=e[b]["points"][g]["y"];f=true;break}}if(f==false){this.data[h]["points"].push(e[b]["points"][g])}}for(g in e[b]){if(g!="points"){this.data[h][g]=e[b][g]}}break}}if(i==false){this.data.push(e[b])}}for(var h in this.data){if(this.data[h]["points"].length>1){this.data[h]["points"].sort(function(k,j){return d.get("order",k,j)})}}};x3.line.prototype.redraw=function(){this.transition=true;this.draw();this.transition=false};x3.line.prototype.draw=function(){var c=this;for(var a in this.data){if(!(this.data[a]["id"] in this.lines)){var b=this.lines[this.data[a]["id"]]=d3.select("#"+this.id).append("path").attr("class","_"+this.data[a]["id"].toString()).attr("stroke",this.data[a]["color"]).attr("stroke-width",this.data[a]["width"]).attr("fill","none");b.data([this.data[a]]);b.attr("d",function(g,f){return c.line(g.points)}).attr("stroke",function(g,f){return g.color}).attr("stroke-width",function(g,f){return g.width}).attr("class",function(g,f){return"_"+g.id.toString()});if(this.transition==true){var e=b.node().getTotalLength();b.attr("stroke-width",function(g,f){return g.width}).attr("stroke-dasharray",e+" "+e).attr("stroke-dashoffset",e).transition().ease("linear").duration(this.get("parent").get("transitionSpeed")).attr("stroke-dashoffset",0)}}else{var d=b=this.lines[this.data[a]["id"]].data([this.data[a]]);b.attr("d",function(h,g){var f=d3.select(this);return f.attr("d")!=null?f.attr("d"):c.line([h.points[0]])});if(this.transition==true){d=d.transition().ease("linear").duration(this.get("parent").get("transitionSpeed"))}d.attr("stroke",function(g,f){return g.color}).attr("stroke-width",function(g,f){return g.width}).attr("class",function(g,f){return"_"+g.id.toString()});if(this.transition==false){b.attr("d",function(g,f){return c.line(g.points)})}else{if(b.attr("d")!=this.line(this.data[a]["points"])){d.attrTween("d",function(l,h){var g=d3.select(this),o=g.attr("d"),n=c.line(l.points),j=4,r=this,q=r.cloneNode(),k=r.getTotalLength();n1=(q.setAttribute("d",n),q).getTotalLength();b.attr("stroke-dasharray",null).attr("stroke-dashoffset",null);var m=[0],h=0,f=j/Math.max(k,n1);while((h+=f)<1){m.push(h)}m.push(1);var p=m.map(function(i){var u=r.getPointAtLength(i*k),s=q.getPointAtLength(i*n1);return d3.interpolate([u.x,u.y],[s.x,s.y])});return function(i){return i<1?"M"+p.map(function(s){return s(i)}).join("L"):n}})}}}}};x3.pie=function(){var a=this;this.transition=false;this.arc=null;this.pie=null;this.datagroup=null;this.container=null;this.id=this.uniqID();this.trigger("data",this._setData);this.set("arc",this._getArc);this.set("container",this._getContainer);this.set("datagroup",this._getDatagroup);this.set("id",this.id)};x3.pie=x3.pie.extendsFrom(Function.extensions);x3.pie.prototype.create=function(){var a=this;this.group=this.get("parent").get("svg").selectAll("#"+this.id).data([null]).enter().append("g").attr("id",this.id);this.arc=d3.svg.arc().outerRadius(0).innerRadius(0);this.pie=d3.layout.pie().sort(null).value(function(b){return b.value})};x3.pie.prototype._getArc=function(){return this.arc};x3.pie.prototype._getContainer=function(){return this.container};x3.pie.prototype._getDatagroup=function(){return this.datagroup};x3.pie.prototype._setData=function(){var a=this;this.data=this.get("data");this.container=d3.select("#"+this.id).selectAll(".arc").data(this.pie(this.data));this.datagroup=this.container.enter().append("g").attr("class","arc")};x3.pie.prototype.redraw=function(){this.transition=true;this.draw();this.transition=false};x3.pie.prototype._transition=function(){var a=this;var b=this.container;if(this.get("parent").get("transitionSpeed")>0&&this.transition==true){b=b.transition().duration(this.get("parent").get("transitionSpeed"))}b.attr("transform","translate("+(this.get("parent").get("innerWidth")/2)+", "+(this.get("parent").get("innerHeight")/2)+")");b=this.container.select("path");if(this.get("parent").get("transitionSpeed")>0&&this.transition==true){b.transition().duration(this.get("parent").get("transitionSpeed")).attrTween("d",function(f){var e=d3.interpolate(this._current,f),c=d3.interpolate(a.oldRadius,a.radius);this._current=e(0);return function(d){return a.arc.outerRadius(c(d))(e(d))}}).attr("fill",function(e,c){if("color" in e.data){return e.data["color"]}else{return d3.select(this).attr("fill")}})}else{b.attr("d",this.arc).attr("fill",function(e,c){if("color" in e.data){return e.data["color"]}else{return d3.select(this).attr("fill")}})}};x3.pie.prototype.draw=function(){var a=this;this.oldRadius=this.radius;this.radius=Math.min(this.get("parent").get("innerWidth"),this.get("parent").get("innerHeight"))/2;this.arc.outerRadius(this.radius);this._transition();if(this.datagroup==undefined){return}var b=this.datagroup.append("path").attr("d",this.arc).attr("fill",function(e,c){if("color" in e.data){return e.data["color"]}else{return d3.select(this).attr("fill")}}).each(function(c){this._current=c});if(!(this.get("parent").get("transitionSpeed")>0&&this.transition==true)){this._transition()}};function luminance(f,e,c){var d=[f,e,c].map(function(a){a/=255;return(a<=0.03928)?a/12.92:Math.pow(((a+0.055)/1.055),2.4)});return d[0]*0.2126+d[1]*0.7152+d[2]*0.0722}function hexToRgb(b){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);return a?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:null}x3.pieText=function(){var a=this;this.parent=null;this.transition=false;this.colors=d3.scale.category20();this.id=this.uniqID();this.set("text",this._getText);this.set("key","value")};x3.pieText=x3.pieText.extendsFrom(Function.extensions);x3.pieText.prototype._getText=function(b,a){return b};x3.pieText.prototype.create=function(){var a=this};x3.pieText.prototype.redraw=function(){this.transition=true;this.draw();this.transition=false};x3.pieText.prototype._transition=function(){var a=this;tmp=this.get("parent").get("container").select("text");if(this.get("parent").get("parent").get("transitionSpeed")>0&&this.transition==true){tmp.transition().duration(this.get("parent").get("parent").get("transitionSpeed")).tween("text",function(h,f){var g=this;var c=this._text;var b=d3.interpolate(c,h[a.get("key")]);var e=d3.interpolate(this._current,h);return function(d){if((e(d)["endAngle"]-e(d)["startAngle"])>0.5){d3.select(g).text(a.get("text",Math.round(b(d)),f))}else{d3.select(g).text("")}}}).attrTween("transform",function(e){var c=this;var b=d3.interpolate(this._current,e);this._current=b(0);return function(d){var f=a.get("parent").get("arc").centroid(b(d));return"translate("+(f[0]*1.25)+", "+(f[1]*1.25)+")"}}).attr("class",function(e,c){var b=[0,0,0];if("color" in e.data){b=hexToRgb(e.data["color"]);return(((luminance(255,255,255)+0.05)/(luminance(b[0],b[1],b[2])+0.05))<1.5)?"dark":"light"}else{return d3.select(this).attr("class")}})}else{tmp.text(function(c,b){this._text=c[a.get("key")];return a.get("text",c[a.get("key")],b)}).attr("class",function(e,c){var b=[0,0,0];if("color" in e.data){b=hexToRgb(e.data["color"]);return(((luminance(255,255,255)+0.05)/(luminance(b[0],b[1],b[2])+0.05))<1.5)?"dark":"light"}else{return d3.select(this).attr("class")}}).attr("transform",function(b){b.outerRadius=a.radius;b.innerRadius=a.radius/2;var c=a.get("parent").get("arc").centroid(b);return"translate("+(c[0]*1.25)+", "+(c[1]*1.25)+")"})}};x3.pieText.prototype.draw=function(){var a=this;this._transition();if(this.get("parent").get("datagroup")==undefined){return}var b=this.get("parent").get("datagroup").append("text").text(function(e,c){this._text=e[a.get("key")];return a.get("text",e[a.get("key")],c)}).attr("class",function(f,e){var c=[0,0,0];if("color" in f.data){c=hexToRgb(f.data["color"]);return(((luminance(255,255,255)+0.05)/(luminance(c[0],c[1],c[2])+0.05))<1.5)?"dark":"light"}else{return d3.select(this).attr("class")}}).attr("text-anchor","middle").attr("transform",function(c){c.outerRadius=a.get("parent").radius;c.innerRadius=a.get("parent").radius/2;var e=a.get("parent").get("arc").centroid(c);return"translate("+(e[0]*1.25)+", "+(e[1]*1.25)+")"}).each(function(c){this._current=c});if(!(this.get("parent").get("parent").get("transitionSpeed")>0&&this.transition==true)){this._transition()}};